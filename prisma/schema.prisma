generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Program {
  id                   String    @id @default(uuid())
  programName          String    @unique @default("N/A") @map("program_name")
  tagline              String    @default("No tagline provided.")
  description          String    @default("No description provided.")
  category             String    @default("Not specified")
  websiteUrl           String    @unique @map("website_url")
  affiliateUrl         String    @unique @map("affiliate_url")
  country              Country   @default(Other)
  xHandle              String?   @map("x_handle")
  email                String?
  logoUrl              String?   @map("logo_url")
  commissionRate       Int       @default(0)
  commissionDuration   String?   @map("commission_duration")
  cookieDuration       Int?      @map("cookie_duration")
  payoutMethod         String?   @map("payout_method")
  minPayoutValue       Int?      @map("min_payout_value")
  avgOrderValue        Int?      @map("avg_order_value")
  targetAudience       String?   @map("target_audience")
  additionalInfo       String?   @map("additional_info")
  affiliatesCountRange String?   @map("affiliates_count_range")
  payoutsTotalRange    String?   @map("payouts_total_range")
  foundingDate         DateTime? @map("founding_date")
  approvalTimeRange    String?   @map("approval_time_range")
  clicksCount          Int       @default(0) @map("clicks_count")
  approvalStatus       Boolean   @default(true) @map("approval_status")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt
}

enum Country {
  US
  GB
  DE
  FR
  ES
  IT
  NL
  BE
  AT
  CH
  SE
  NO
  DK
  FI
  PL
  CZ
  PT
  IE
  RU
  UA
  CA
  MX
  BR
  AR
  CO
  CL
  AU
  NZ
  JP
  KR
  CN
  HK
  SG
  IN
  ID
  TH
  VN
  MY
  PH
  AE
  SA
  IL
  TR
  EG
  ZA
  NG
  KE
  Other
}

// Analytics event for tracking unique views with anti-fraud
model AnalyticsEvent {
  id          String   @id @default(uuid())
  programId   String   @map("program_id")
  eventType   String   @default("view") @map("event_type") // "view" or "click"
  fingerprint String   // Browser fingerprint hash
  ipHash      String   @map("ip_hash") // Hashed IP for privacy
  userAgent   String?  @map("user_agent")
  referer     String?
  country     String?
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([programId])
  @@index([programId, fingerprint])
  @@index([programId, createdAt])
  @@index([fingerprint, ipHash, programId])
  @@map("analytics_events")
}
