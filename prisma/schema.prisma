generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TrafficLog {
  id        String   @id @default(cuid())
  path      String
  referrer  String?
  userAgent String?
  country   String?
  ip        String?
  visitorId String?  @map("visitor_id")
  programId String?  @map("program_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@index([createdAt])
  @@index([country, createdAt])
  @@map("traffic_logs")
}

model ProgramEvent {
  id        String   @id @default(cuid())
  programId String   @map("program_id")
  program   Program  @relation(fields: [programId], references: [id], onDelete: Cascade)
  type      String
  dateKey   String   @map("date_key")
  visitorId String   @default(uuid()) @map("visitor_id")
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([programId, visitorId, type, dateKey])
  @@index([programId, type, dateKey])
  @@index([createdAt])
  @@map("program_events")
}

model SearchLog {
  id           String   @id @default(uuid())
  query        String
  resultsCount Int      @map("results_count")
  sessionId    String   @default(uuid()) @map("session_id")
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([query])
  @@index([createdAt])
  @@index([resultsCount])
  @@map("search_logs")
}

model Program {
  id                   String          @id @default(uuid())
  programName          String          @unique @default("N/A") @map("program_name")
  tagline              String          @default("No tagline provided.")
  description          String          @default("No description provided.")
  category             String          @default("Not specified")
  websiteUrl           String          @unique @map("website_url")
  affiliateUrl         String          @unique @map("affiliate_url")
  country              Country         @default(Other)
  xHandle              String?         @map("x_handle")
  email                String?
  logoUrl              String?         @map("logo_url")
  commissionRate       Int             @default(0)
  commissionDuration   String?         @map("commission_duration")
  cookieDuration       Int?            @map("cookie_duration")
  commissionType       CommissionType  @default(PERCENTAGE) @map("commission_type")
  payoutMethod         String?         @map("payout_method")
  minPayoutValue       Int?            @map("min_payout_value")
  avgOrderValue        Int?            @map("avg_order_value")
  targetAudience       String?         @map("target_audience")
  additionalInfo       String?         @map("additional_info")
  affiliatesCountRange String?         @map("affiliates_count_range")
  payoutsTotalRange    String?         @map("payouts_total_range")
  foundingDate         DateTime?       @map("founding_date")
  approvalTimeRange    String?         @map("approval_time_range")
  approvalStatus       Boolean         @default(true) @map("approval_status")
  createdAt            DateTime        @default(now()) @map("created_at")
  updatedAt            DateTime        @updatedAt
  featuredExpiresAt    DateTime?       @map("featured_expires_at")
  isFeatured           Boolean         @default(false) @map("is_featured")
  slug                 String?         @unique
  qualityScore         Int             @default(0) @map("quality_score")
  totalViews           Int             @default(0) @map("total_views")
  clicks               Int             @default(0)
  trendingScore        Float           @default(0) @map("trending_score")
  manualScoreBoost     Int             @default(0) @map("manual_score_boost")
  reports              ProgramReport[]
  events               ProgramEvent[]

  @@index([approvalStatus, trendingScore, createdAt])
  @@index([isFeatured, featuredExpiresAt])
  @@index([programName, category])
}

model ProgramReport {
  id         String       @id @default(uuid())
  programId  String       @map("program_id")
  type       ReportType   @default(EDIT)
  reason     String?
  message    String
  email      String?
  isFounder  Boolean      @default(false) @map("is_founder")
  status     ReportStatus @default(PENDING)
  createdAt  DateTime     @default(now()) @map("created_at")
  resolvedAt DateTime?    @map("resolved_at")
  program    Program      @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([programId])
  @@index([status])
  @@map("program_reports")
}

enum EventName {
  VIEW
  CLICK
  OUTBOUND
}

enum ReportType {
  EDIT
  REPORT
}

enum ReportStatus {
  PENDING
  RESOLVED
  DISMISSED
}

enum CommissionType {
  PERCENTAGE
  FIXED
}

enum Country {
  US
  GB
  DE
  FR
  ES
  IT
  NL
  BE
  AT
  CH
  SE
  NO
  DK
  FI
  IE
  PT
  PL
  CZ
  HU
  RO
  GR
  SK
  BG
  HR
  LT
  LV
  EE
  SI
  LU
  IS
  MT
  CY
  RU
  UA
  BY
  MD
  AL
  BA
  ME
  MK
  RS
  AM
  AZ
  GE
  TR
  CA
  MX
  BR
  AR
  CO
  CL
  PE
  VE
  EC
  BO
  PY
  UY
  CR
  PA
  DO
  GT
  HN
  SV
  NI
  CU
  JM
  TT
  AU
  NZ
  JP
  KR
  CN
  IN
  ID
  TH
  VN
  MY
  PH
  SG
  TW
  HK
  MO
  PK
  BD
  LK
  NP
  KP
  KH
  LA
  MM
  UZ
  KZ
  TM
  TJ
  KG
  AE
  SA
  IL
  QA
  KW
  OM
  BH
  JO
  LB
  SY
  IQ
  IR
  YE
  PS
  EG
  ZA
  NG
  KE
  MA
  DZ
  TN
  LY
  ET
  GH
  TZ
  UG
  SN
  CI
  CM
  AO
  MZ
  ZM
  ZW
  NA
  BW
  MU
  RW
  SD
  SS
  ML
  BF
  NE
  GN
  LR
  SL
  BJ
  TG
  GA
  CG
  CD
  GQ
  ST
  SC
  MG
  MR
  ER
  DJ
  SO
  LS
  SZ
  MW
  BI
  KM
  Other
}
